stream
  |from()
    .measurement('bgpstat')
  |groupBy('host')
  |alert()
    .id('kapacitor/{{ index .Tags "host" }}')
    .message('BGP Peer Failure - {{ .ID }}. Alert Level is {{ .Level }}. Peer Failure Count: {{ index .Fields "failed_peers" }}')
    .crit(lambda: "failed_peers" > 0)
    .stateChangesOnly()
    .log('/tmp/alerts.log')
    .slack()
    .channel('#alerts')
